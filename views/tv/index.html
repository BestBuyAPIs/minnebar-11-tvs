{% extends "layout.html" %}

{% block content %}

  <div class="row">
    <div class="col-xs-12">
      <div class="gridster">
        <ul>
        </ul>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="/scripts/jquery.fittext.js"></script>
  <script type="text/javascript" src="/scripts/available-widget.js"></script>
  <script type="text/javascript">
    var gridster = $(".gridster ul").gridster({
      widget_base_dimensions: [100, 55],
      widget_margins: [5, 5],
    }).data('gridster');

    var layouts = {{ layouts | safe }};

    $(function(){
      var serialization = layouts[{{ tv.id }}];
      if (layouts.current) {
        serialization = layouts.current;
      }
      gridster.remove_all_widgets();

      $.each(serialization, function() {
        var widgetHTML = '<li id="' + this.id + '"></li>';
        gridster.add_widget(widgetHTML, this.size_x, this.size_y, this.col, this.row);
      });
      gridster.disable();

      $.each(widgets, function (widgetId, widgetInfo) {
        if ($('#' + widgetId).length) {
          console.log('Saw widget "%s"', widgetInfo.name);
          widgetInfo.load($('#' + widgetId));
        }
      });
    });

  </script>
{% endblock %}
